{"version":3,"file":"index.umd.js","sources":["../src/index.ts"],"sourcesContent":["import { SVG } from \"@svgdotjs/svg.js\";\nimport { Vec2 } from \"wtc-math\";\n\nclass Drawing {\n  static defaults = {\n    stroke: \"#333\",\n    pxratio: 1,\n  };\n  static DT_CANVAS = 1;\n  static DT_SVG = 2;\n  #drawing;\n  #ctx;\n  #mode;\n  #instructions = [];\n\n  constructor(mode = Drawing.DT_CANVAS, settings) {\n    settings = Object.assign({}, Drawing.defaults, settings);\n\n    this.mode = mode;\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.#drawing = document.createElement(\"canvas\");\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.#drawing = SVG();\n    }\n\n    this.stroke = settings.stroke;\n    this.pxratio = settings.pxratio;\n  }\n  clear() {\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.clearRect(0, 0, ...this.dimensions.scaleNew(this.pxratio).array);\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing.clear();\n    }\n  }\n  rect(position, dimensions) {\n    if (this.saving) {\n      this.#instructions.push({\n        f: \"rect\",\n        args: [position, dimensions],\n      });\n    }\n    position = position.scaleNew(this.pxratio);\n    dimensions = dimensions.scaleNew(this.pxratio);\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.beginPath();\n      this.c.rect(...position.array, ...dimensions.array);\n      this.c.stroke();\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing\n        .rect(dimensions.width, dimensions.height)\n        .move(...position.array)\n        .fill(this.svgFill)\n        .stroke(\"#f06\");\n    }\n  }\n  circle(position, radius) {\n    if (this.saving) {\n      this.#instructions.push({\n        f: \"circle\",\n        args: [position, radius],\n      });\n    }\n    position = position.scaleNew(this.pxratio);\n    radius *= this.pxratio;\n    if (this.mode & Drawing.DT_CANVAS) {\n      if (this.fill) this.c.fillStyle = this.fill;\n      this.c.beginPath();\n      this.c.arc(position.x, position.y, radius, 0, 2 * Math.PI);\n      if (this.stroke) this.c.stroke();\n      if (this.fill) this.c.fill();\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing\n        .circle(radius * 2)\n        .fill(this.svgFill)\n        .stroke(this.svgStroke)\n        .move(...position.subtractScalarNew(radius).array);\n    }\n  }\n  line(a, b) {\n    if (this.saving) {\n      this.#instructions.push({\n        f: \"line\",\n        args: [a, b],\n      });\n    }\n    a = a.scaleNew(this.pxratio);\n    b = b.scaleNew(this.pxratio);\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.beginPath();\n      this.c.moveTo(a.x, a.y);\n      this.c.lineTo(b.x, b.y);\n      if (this.stroke) this.c.stroke();\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing.line(...a.array, ...b.array).stroke(this.svgStroke);\n    }\n  }\n  polyline(points) {\n    if (this.saving) {\n      this.#instructions.push({\n        f: \"polyline\",\n        args: points,\n      });\n    }\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.beginPath();\n      points.forEach((p, i) => {\n        p = p.scaleNew(this.pxratio);\n        if (i === 0) this.c.moveTo(p.x, p.y);\n        else this.c.lineTo(p.x, p.y);\n      });\n      if (this.stroke) this.c.stroke();\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing\n        .polyline(points.map((p) => p.array))\n        .fill(this.svgFill)\n        .stroke(this.svgStroke);\n    }\n  }\n  path(path) {\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.beginPath();\n      const p1 = new Path2D(path);\n      const m = document\n        .createElementNS(\"http://www.w3.org/2000/svg\", \"svg\")\n        .createSVGMatrix();\n      const p = new Path2D();\n      const t = m.scale(this.pxratio);\n      p.addPath(p1, t);\n      if (this.stroke) this.c.stroke(p);\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing.path(path).fill(this.svgFill).stroke(this.svgStroke);\n    }\n  }\n  polygon(points) {\n    if (this.saving) {\n      this.#instructions.push({\n        f: \"polygon\",\n        args: [points],\n      });\n    }\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.beginPath();\n      points.forEach((p, i) => {\n        p = p.scaleNew(this.pxratio);\n        if (i === 0) this.c.moveTo(p.x, p.y);\n        else this.c.lineTo(p.x, p.y);\n      });\n      if (this.stroke) this.c.stroke();\n      if (this.fill) this.c.fill();\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing\n        .polygon(points.map((p) => p.array))\n        .fill(this.svgFill)\n        .stroke(this.svgStroke);\n    }\n  }\n\n  download() {\n    let d;\n    if (this.mode & Drawing.DT_CANVAS) {\n      d = new Drawing(Drawing.DT_SVG, {}).size(this.dimensions);\n      this.#instructions.forEach((i) => {\n        d[i.f](...i.args);\n      });\n    } else if (this.mode & Drawing.DT_SVG) {\n      d = this;\n    }\n\n    const fileName = \"untitled.svg\";\n    const url =\n      \"data:image/svg+xml;utf8,\" + encodeURIComponent(d.drawing.svg());\n    const link = document.createElement(\"a\");\n    link.download = fileName;\n    link.href = url;\n    link.click();\n  }\n\n  addTo(element) {\n    if (typeof element === \"string\") {\n      if (this.mode & Drawing.DT_CANVAS) {\n        document.body.querySelector(element).appendChild(this.drawing);\n      } else if (this.mode & Drawing.DT_SVG) {\n        this.drawing.addTo(\"#container\");\n      }\n    }\n    return this;\n  }\n\n  size(d) {\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.drawing.width = d.width * this.#pxratio;\n      this.drawing.height = d.height * this.#pxratio;\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing.size(...d.scaleNew(this.#pxratio).array);\n      this.#drawing.viewbox(\n        `0 0 ${d.x * this.#pxratio} ${d.y * this.#pxratio}`\n      );\n    }\n    this.#dimensions = d;\n    return this;\n  }\n\n  #dimensions;\n  set dimensions(v) {\n    if (v instanceof Vec2) {\n      this.#dimensions = v;\n      this.size(v);\n    }\n  }\n  get dimensions() {\n    return this.#dimensions;\n  }\n\n  #pxratio = 1;\n  set pxratio(v) {\n    if (v > 0) {\n      this.#pxratio = v;\n    }\n  }\n  get pxratio() {\n    return this.#pxratio || 1;\n  }\n\n  get drawing() {\n    return this.#drawing;\n  }\n  get c() {\n    if (this.mode & Drawing.DT_CANVAS) {\n      if (this.#ctx) return this.#ctx;\n      this.#ctx = this.drawing.getContext(\"2d\");\n      return this.#ctx;\n    }\n  }\n  #stroke;\n  set stroke(v) {\n    this.#stroke = v;\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.strokeStyle = v;\n    }\n  }\n  get stroke() {\n    return this.#stroke;\n  }\n  get svgStroke() {\n    if (this.#stroke) return this.#stroke;\n    return {};\n  }\n  #fill = null;\n  set fill(v) {\n    this.#fill = v;\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.fillStyle = v;\n    }\n  }\n  get fill() {\n    return this.#fill;\n  }\n  get svgFill() {\n    if (this.#fill) return this.#fill;\n    return \"none\";\n  }\n  set mode(v) {\n    if (v & (Drawing.DT_CANVAS | Drawing.DT_SVG)) {\n      this.#mode = v;\n    }\n  }\n  get mode() {\n    return this.#mode || Drawing.DT_CANVAS;\n  }\n  #saving = false;\n  set saving(v) {\n    this.#saving = v === true;\n  }\n  get saving() {\n    return this.#saving;\n  }\n}\n\nexport default Drawing;"],"names":["Drawing","mode","settings","DT_CANVAS","Object","assign","defaults","this","_classPrivateFieldLooseBase","document","createElement","DT_SVG","SVG","stroke","pxratio","clear","c","clearRect","dimensions","scaleNew","array","drawing","rect","position","saving","push","f","args","beginPath","width","height","move","fill","svgFill","circle","radius","fillStyle","arc","x","y","Math","PI","svgStroke","subtractScalarNew","line","a","b","moveTo","lineTo","polyline","points","forEach","p","i","_this","map","path","p1","Path2D","m","createElementNS","createSVGMatrix","t","scale","addPath","polygon","_this2","download","d","size","url","encodeURIComponent","svg","link","href","click","addTo","element","body","querySelector","appendChild","viewbox","v","Vec2","getContext","strokeStyle"],"mappings":"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"}