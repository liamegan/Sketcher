{"version":3,"file":"index.modern.js","sources":["../src/index.ts"],"sourcesContent":["import { SVG } from \"@svgdotjs/svg.js\";\nimport { Vec2 } from \"wtc-math\";\n\nclass Drawing {\n  static defaults = {\n    stroke: \"#333\",\n    pxratio: 1,\n  };\n  static DT_CANVAS = 1;\n  static DT_SVG = 2;\n  #drawing;\n  #ctx;\n  #mode;\n  #instructions = [];\n\n  constructor(mode = Drawing.DT_CANVAS, settings) {\n    settings = Object.assign({}, Drawing.defaults, settings);\n\n    this.mode = mode;\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.#drawing = document.createElement(\"canvas\");\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.#drawing = SVG();\n    }\n\n    this.stroke = settings.stroke;\n    this.pxratio = settings.pxratio;\n  }\n  clear() {\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.clearRect(0, 0, ...this.dimensions.scaleNew(this.pxratio).array);\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing.clear();\n    }\n  }\n  rect(position, dimensions) {\n    if (this.saving) {\n      this.#instructions.push({\n        f: \"rect\",\n        args: [position, dimensions],\n      });\n    }\n    position = position.scaleNew(this.pxratio);\n    dimensions = dimensions.scaleNew(this.pxratio);\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.beginPath();\n      this.c.rect(...position.array, ...dimensions.array);\n      this.c.stroke();\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing\n        .rect(dimensions.width, dimensions.height)\n        .move(...position.array)\n        .fill(this.svgFill)\n        .stroke(\"#f06\");\n    }\n  }\n  circle(position, radius) {\n    if (this.saving) {\n      this.#instructions.push({\n        f: \"circle\",\n        args: [position, radius],\n      });\n    }\n    position = position.scaleNew(this.pxratio);\n    radius *= this.pxratio;\n    if (this.mode & Drawing.DT_CANVAS) {\n      if (this.fill) this.c.fillStyle = this.fill;\n      this.c.beginPath();\n      this.c.arc(position.x, position.y, radius, 0, 2 * Math.PI);\n      if (this.stroke) this.c.stroke();\n      if (this.fill) this.c.fill();\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing\n        .circle(radius * 2)\n        .fill(this.svgFill)\n        .stroke(this.svgStroke)\n        .move(...position.subtractScalarNew(radius).array);\n    }\n  }\n  line(a, b) {\n    if (this.saving) {\n      this.#instructions.push({\n        f: \"line\",\n        args: [a, b],\n      });\n    }\n    a = a.scaleNew(this.pxratio);\n    b = b.scaleNew(this.pxratio);\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.beginPath();\n      this.c.moveTo(a.x, a.y);\n      this.c.lineTo(b.x, b.y);\n      if (this.stroke) this.c.stroke();\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing.line(...a.array, ...b.array).stroke(this.svgStroke);\n    }\n  }\n  polyline(points) {\n    if (this.saving) {\n      this.#instructions.push({\n        f: \"polyline\",\n        args: points,\n      });\n    }\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.beginPath();\n      points.forEach((p, i) => {\n        p = p.scaleNew(this.pxratio);\n        if (i === 0) this.c.moveTo(p.x, p.y);\n        else this.c.lineTo(p.x, p.y);\n      });\n      if (this.stroke) this.c.stroke();\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing\n        .polyline(points.map((p) => p.array))\n        .fill(this.svgFill)\n        .stroke(this.svgStroke);\n    }\n  }\n  path(path) {\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.beginPath();\n      const p1 = new Path2D(path);\n      const m = document\n        .createElementNS(\"http://www.w3.org/2000/svg\", \"svg\")\n        .createSVGMatrix();\n      const p = new Path2D();\n      const t = m.scale(this.pxratio);\n      p.addPath(p1, t);\n      if (this.stroke) this.c.stroke(p);\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing.path(path).fill(this.svgFill).stroke(this.svgStroke);\n    }\n  }\n  polygon(points) {\n    if (this.saving) {\n      this.#instructions.push({\n        f: \"polygon\",\n        args: [points],\n      });\n    }\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.beginPath();\n      points.forEach((p, i) => {\n        p = p.scaleNew(this.pxratio);\n        if (i === 0) this.c.moveTo(p.x, p.y);\n        else this.c.lineTo(p.x, p.y);\n      });\n      if (this.stroke) this.c.stroke();\n      if (this.fill) this.c.fill();\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing\n        .polygon(points.map((p) => p.array))\n        .fill(this.svgFill)\n        .stroke(this.svgStroke);\n    }\n  }\n\n  download() {\n    let d;\n    if (this.mode & Drawing.DT_CANVAS) {\n      d = new Drawing(Drawing.DT_SVG, {}).size(this.dimensions);\n      this.#instructions.forEach((i) => {\n        d[i.f](...i.args);\n      });\n    } else if (this.mode & Drawing.DT_SVG) {\n      d = this;\n    }\n\n    const fileName = \"untitled.svg\";\n    const url =\n      \"data:image/svg+xml;utf8,\" + encodeURIComponent(d.drawing.svg());\n    const link = document.createElement(\"a\");\n    link.download = fileName;\n    link.href = url;\n    link.click();\n  }\n\n  addTo(element) {\n    if (typeof element === \"string\") {\n      if (this.mode & Drawing.DT_CANVAS) {\n        document.body.querySelector(element).appendChild(this.drawing);\n      } else if (this.mode & Drawing.DT_SVG) {\n        this.drawing.addTo(\"#container\");\n      }\n    }\n    return this;\n  }\n\n  size(d) {\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.drawing.width = d.width * this.#pxratio;\n      this.drawing.height = d.height * this.#pxratio;\n    } else if (this.mode & Drawing.DT_SVG) {\n      this.drawing.size(...d.scaleNew(this.#pxratio).array);\n      this.#drawing.viewbox(\n        `0 0 ${d.x * this.#pxratio} ${d.y * this.#pxratio}`\n      );\n    }\n    this.#dimensions = d;\n    return this;\n  }\n\n  #dimensions;\n  set dimensions(v) {\n    if (v instanceof Vec2) {\n      this.#dimensions = v;\n      this.size(v);\n    }\n  }\n  get dimensions() {\n    return this.#dimensions;\n  }\n\n  #pxratio = 1;\n  set pxratio(v) {\n    if (v > 0) {\n      this.#pxratio = v;\n    }\n  }\n  get pxratio() {\n    return this.#pxratio || 1;\n  }\n\n  get drawing() {\n    return this.#drawing;\n  }\n  get c() {\n    if (this.mode & Drawing.DT_CANVAS) {\n      if (this.#ctx) return this.#ctx;\n      this.#ctx = this.drawing.getContext(\"2d\");\n      return this.#ctx;\n    }\n  }\n  #stroke;\n  set stroke(v) {\n    this.#stroke = v;\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.strokeStyle = v;\n    }\n  }\n  get stroke() {\n    return this.#stroke;\n  }\n  get svgStroke() {\n    if (this.#stroke) return this.#stroke;\n    return {};\n  }\n  #fill = null;\n  set fill(v) {\n    this.#fill = v;\n    if (this.mode & Drawing.DT_CANVAS) {\n      this.c.fillStyle = v;\n    }\n  }\n  get fill() {\n    return this.#fill;\n  }\n  get svgFill() {\n    if (this.#fill) return this.#fill;\n    return \"none\";\n  }\n  set mode(v) {\n    if (v & (Drawing.DT_CANVAS | Drawing.DT_SVG)) {\n      this.#mode = v;\n    }\n  }\n  get mode() {\n    return this.#mode || Drawing.DT_CANVAS;\n  }\n  #saving = false;\n  set saving(v) {\n    this.#saving = v === true;\n  }\n  get saving() {\n    return this.#saving;\n  }\n}\n\nexport default Drawing;"],"names":["Drawing","constructor","mode","DT_CANVAS","settings","Object","assign","defaults","this","_classPrivateFieldLooseBase","document","createElement","DT_SVG","SVG","stroke","pxratio","clear","c","clearRect","dimensions","scaleNew","array","drawing","rect","position","saving","push","f","args","beginPath","width","height","move","fill","svgFill","circle","radius","fillStyle","arc","x","y","Math","PI","svgStroke","subtractScalarNew","line","a","b","moveTo","lineTo","polyline","points","forEach","p","i","map","path","p1","Path2D","m","createElementNS","createSVGMatrix","t","scale","addPath","polygon","download","d","size","url","encodeURIComponent","svg","link","href","click","addTo","element","body","querySelector","appendChild","viewbox","v","Vec2","getContext","strokeStyle"],"mappings":"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"}